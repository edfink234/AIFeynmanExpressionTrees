<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Track Fit Report - v20260122_163839 train/test (noise XY=0.01, Z=0.01)</title>

  <!-- MathJax for LaTeX rendering -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: "global" }   // SVG output; no webfont fetches
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-svg.js"></script>

  <!-- TeX-y text fonts -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/latin-modern-roman/index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/latin-modern-math/index.css">

  <style>
    body {
      font-family: "Latin Modern Roman", "Computer Modern", "CMU Serif", serif;
      margin: 24px;
      background: #fafafa;
    }
    h1 {
      margin: 0 0 8px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }
    .subtle { color: #555; margin-top: 0; }

    .toolbar {
      display: flex; align-items: center; gap: 12px;
      position: sticky; top: 0; background: #fafafa;
      padding: 12px 0; z-index: 2;
      border-bottom: 1px solid #eee;
    }
    button {
      padding: 7px 14px;
      border-radius: 999px;
      border: 1px solid #ddd;
      background: #fff;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
    }
    button:hover { box-shadow: 0 2px 6px rgba(0,0,0,0.06); }
    .counter { color: #444; font-size: 14px; }

    .card {
      border-radius: 16px;
      padding: 16px 20px 20px;
      background: #fff;
      max-width: 980px;
      margin: 0 auto; 
      box-shadow: 0 6px 18px rgba(0,0,0,0.04);
      border: 1px solid #eee;
    }
    
    .eqJump {
      text-decoration: none;
      border-bottom: 1px dotted #888;
      color: inherit;
    }
    .eqJump:hover {
      border-bottom-style: solid;
    }

    
    .meta { font-size: 13px; color: #444; margin: 6px 0 0; }
    .meta b { font-weight: 600; }

    .metrics {
      text-align: center;
      margin: 14px 0 8px;
    }
    .metrics mjx-container {
      font-size: 1.05em;
    }

    .eq {
      font-size: 14px;
      margin-top: 14px;
      text-align: center;
      line-height: 1.6;
    }
    .eq mjx-container {
      font-size: 1.02em;
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
    }
    img {
      width: 100%;
      height: auto;
      border-radius: 12px;
      border: 1px solid #eee;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Track Fit Report - v20260122_163839 train/test (noise XY=0.01, Z=0.01)</h1>
  <p class="subtle">Dataset: <span class="mono">../tracks_for_ed/v20260122_163839__train10_test10__layers25_len320p0__r3p1-53p0__fd25-25__func3-3__noiseXY0p01_Z0p01/</span></p>
  <p class="subtle">Use ← / → or the buttons to scroll through tracks (grouped by family).</p>

  <div class="toolbar">
    <button id="prevBtn">← Prev</button>
    <button id="nextBtn">Next →</button>
    <span class="counter" id="counter"></span>
  </div>

  <div class="card" id="card"></div>

  <script>
    // Data injected from Python below
    const slides = [{"fid": 0, "Fx": 7, "Fy": 14, "Fz": 7, "track_idx": 1, "event_id": "event100000002-hits", "png": "pngs/SR_track_v20260122_163839__train10_test10__layers25_len320p0__r3p1-53p0__fd25-25__func3-3__noiseXY0p01_Z0p01event100000002-hits.png", "img_src": "pngs/SR_track_v20260122_163839__train10_test10__layers25_len320p0__r3p1-53p0__fd25-25__func3-3__noiseXY0p01_Z0p01event100000002-hits.png", "metrics_line": "\\begin{align*}&R^2:\\, x=1.000,\\;y=0.997,\\;z=1.000\\\\&\\chi^2_\\nu:\\;\\mathrm{x}=2.257 \\times 10^{1},\\;\\mathrm{y}=5.191 \\times 10^{2},\\;\\mathrm{z}=7.061 \\times 10^{0}\\end{align*}", "eqx": "$x(s) = 73.77 \\sin{\\left(0.716 s \\right)} + 3.107$", "eqy": "$y(s) = \\left(4.866 - 18.845 s\\right) \\sqrt{\\tanh{\\left(s \\right)}}$", "eqz": "$z(s) = s \\left(13.763 s + 2.014\\right) + 0.285$"}, {"fid": 1, "Fx": 14, "Fy": 2, "Fz": 15, "track_idx": 3, "event_id": "event100000004-hits", "png": "pngs/SR_track_v20260122_163839__train10_test10__layers25_len320p0__r3p1-53p0__fd25-25__func3-3__noiseXY0p01_Z0p01event100000004-hits.png", "img_src": "pngs/SR_track_v20260122_163839__train10_test10__layers25_len320p0__r3p1-53p0__fd25-25__func3-3__noiseXY0p01_Z0p01event100000004-hits.png", "metrics_line": "\\begin{align*}&R^2:\\, x=0.781,\\;y=0.524,\\;z=0.138\\\\&\\chi^2_\\nu:\\;\\mathrm{x}=1.467 \\times 10^{6},\\;\\mathrm{y}=1.674 \\times 10^{6},\\;\\mathrm{z}=4.080 \\times 10^{6}\\end{align*}", "eqx": "$x(s) = 44.021 \\sin{\\left(\\sin{\\left(6.029 s \\right)} \\right)} - 3.061$", "eqy": "$y(s) = 44.347 s \\cos{\\left(8.776 s \\right)} + 0.69$", "eqz": "$z(s) = 9.012 - 21.647 \\sin{\\left(21.223 e^{s} \\right)}$"}, {"fid": 2, "Fx": 25, "Fy": 23, "Fz": 10, "track_idx": 4, "event_id": "event100000005-hits", "png": "pngs/SR_track_v20260122_163839__train10_test10__layers25_len320p0__r3p1-53p0__fd25-25__func3-3__noiseXY0p01_Z0p01event100000005-hits.png", "img_src": "pngs/SR_track_v20260122_163839__train10_test10__layers25_len320p0__r3p1-53p0__fd25-25__func3-3__noiseXY0p01_Z0p01event100000005-hits.png", "metrics_line": "\\begin{align*}&R^2:\\, x=0.979,\\;y=0.997,\\;z=0.995\\\\&\\chi^2_\\nu:\\;\\mathrm{x}=1.899 \\times 10^{4},\\;\\mathrm{y}=7.231 \\times 10^{3},\\;\\mathrm{z}=9.587 \\times 10^{3}\\end{align*}", "eqx": "$x(s) = 22.56 \\sqrt{s} \\cos{\\left(3.227 s \\right)}$", "eqy": "$y(s) = 51.27 \\sin{\\left(1.551 s \\right)} - 1.0$", "eqz": "$z(s) = {0.161}^{\\cos{\\left(4.133 s \\right)} - 2.209} \\left(\\operatorname{sech}{\\left(10.913 s - 1.186 \\right)} - 0.055\\right) + \\cos{\\left(4^{2.422 - s} \\right)} + \\cos{\\left(29.832 \\sin{\\left(s \\right)} \\right)}$"}, {"fid": 3, "Fx": 31, "Fy": 17, "Fz": 18, "track_idx": 0, "event_id": "event100000001-hits", "png": "pngs/SR_track_v20260122_163839__train10_test10__layers25_len320p0__r3p1-53p0__fd25-25__func3-3__noiseXY0p01_Z0p01event100000001-hits.png", "img_src": "pngs/SR_track_v20260122_163839__train10_test10__layers25_len320p0__r3p1-53p0__fd25-25__func3-3__noiseXY0p01_Z0p01event100000001-hits.png", "metrics_line": "\\begin{align*}&R^2:\\, x=0.997,\\;y=0.976,\\;z=0.978\\\\&\\chi^2_\\nu:\\;\\mathrm{x}=4.728 \\times 10^{3},\\;\\mathrm{y}=6.312 \\times 10^{4},\\;\\mathrm{z}=1.460 \\times 10^{5}\\end{align*}", "eqx": "$x(s) = - 66.48 s + 63.017 s^{35.294}$", "eqy": "$y(s) = 54.446 \\cos{\\left(1.3 e^{s} \\right)} - 2.602$", "eqz": "$z(s) = 41.043 - 41.928 e^{\\sin{\\left(2.731 s \\right)}}$"}, {"fid": 4, "Fx": 40, "Fy": 17, "Fz": 10, "track_idx": 2, "event_id": "event100000003-hits", "png": "pngs/SR_track_v20260122_163839__train10_test10__layers25_len320p0__r3p1-53p0__fd25-25__func3-3__noiseXY0p01_Z0p01event100000003-hits.png", "img_src": "pngs/SR_track_v20260122_163839__train10_test10__layers25_len320p0__r3p1-53p0__fd25-25__func3-3__noiseXY0p01_Z0p01event100000003-hits.png", "metrics_line": "\\begin{align*}&R^2:\\, x=0.229,\\;y=0.572,\\;z=0.821\\\\&\\chi^2_\\nu:\\;\\mathrm{x}=3.136 \\times 10^{6},\\;\\mathrm{y}=2.466 \\times 10^{6},\\;\\mathrm{z}=3.345 \\times 10^{6}\\end{align*}", "eqx": "$x(s) = 122.85 s \\left(s - 0.976\\right) + 10.936$", "eqy": "$y(s) = 23.577 \\cos{\\left(8.26 e^{s} \\right)} - 2.404$", "eqz": "$z(s) = {0.446}^{\\cos{\\left(9.63 s \\right)} - 4.691} \\left(\\operatorname{sech}{\\left(11.224 s - 3.472 \\right)} - 1.153\\right) + \\left(s + 0.942\\right)^{-72.488} + \\cos{\\left(4^{2.41 - s} \\right)} + \\cos{\\left(33.71 \\sin{\\left(s \\right)} \\right)}$"}];
    const eqSlides = [{"key": ["x", "Add(Symbol('a0'), Mul(Symbol('a2'), sin(Mul(Symbol('a1'), Symbol('s')))))"], "eq": "$x(s) = a_{0} + a_{2} \\sin{\\left(a_{1} s \\right)}$", "uses": [{"slide": 0, "label": "2-x", "rep_fam": 7}]}, {"key": ["y", "Mul(Add(Mul(Symbol('a0'), Symbol('x0')), Symbol('a1')), Pow(tanh(Symbol('x0')), Rational(1, 2)))"], "eq": "$y(s) = \\left(a_{0} s + a_{1}\\right) \\sqrt{\\tanh{\\left(s \\right)}}$", "uses": [{"slide": 0, "label": "2-y", "rep_fam": 14}]}, {"key": ["z", "Add(Symbol('a1'), Mul(Symbol('s'), Add(Symbol('a0'), Mul(Symbol('a2'), Symbol('s')))))"], "eq": "$z(s) = a_{1} + s \\left(a_{0} + a_{2} s\\right)$", "uses": [{"slide": 0, "label": "2-z", "rep_fam": 7}]}, {"key": ["x", "Add(Mul(Symbol('a0'), sin(sin(Mul(Symbol('a2'), Symbol('x0'))))), Mul(Integer(-1), Symbol('a1')))"], "eq": "$x(s) = a_{0} \\sin{\\left(\\sin{\\left(a_{2} s \\right)} \\right)} - a_{1}$", "uses": [{"slide": 1, "label": "4-x", "rep_fam": 14}]}, {"key": ["y", "Add(Symbol('a1'), Mul(Symbol('a2'), Symbol('s'), cos(Mul(Symbol('a0'), Symbol('s')))))"], "eq": "$y(s) = a_{1} + a_{2} s \\cos{\\left(a_{0} s \\right)}$", "uses": [{"slide": 1, "label": "4-y", "rep_fam": 2}]}, {"key": ["z", "Mul(Symbol('a2'), Add(Symbol('a0'), Mul(Integer(-1), sin(exp(Add(Symbol('a1'), Symbol('x0')))))))"], "eq": "$z(s) = a_{2} \\left(a_{0} - \\sin{\\left(e^{a_{1} + s} \\right)}\\right)$", "uses": [{"slide": 1, "label": "4-z", "rep_fam": 15}]}, {"key": ["x", "Mul(Symbol('a1'), Pow(Symbol('x0'), Rational(1, 2)), cos(Mul(Symbol('a0'), Symbol('x0'))))"], "eq": "$x(s) = a_{1} \\sqrt{s} \\cos{\\left(a_{0} s \\right)}$", "uses": [{"slide": 2, "label": "5-x", "rep_fam": 25}]}, {"key": ["y", "Add(Mul(Symbol('a2'), sin(Mul(Symbol('a1'), Symbol('x0')))), cos(Symbol('a0')))"], "eq": "$y(s) = a_{2} \\sin{\\left(a_{1} s \\right)} + \\cos{\\left(a_{0} \\right)}$", "uses": [{"slide": 2, "label": "5-y", "rep_fam": 23}]}, {"key": ["z", "Add(Mul(Pow(Symbol('a4'), Add(Symbol('a1'), cos(Mul(Symbol('a7'), Symbol('s'))))), Add(Symbol('a3'), sech(Add(Symbol('a2'), Mul(Symbol('a8'), Symbol('s')))))), Pow(Add(Symbol('a5'), Symbol('s')), Symbol('a0')), cos(Pow(Integer(4), Add(Symbol('a6'), Mul(Integer(-1), Symbol('s'))))), cos(Mul(Symbol('a9'), sin(Symbol('s')))))"], "eq": "$z(s) = a_{4}^{a_{1} + \\cos{\\left(a_{7} s \\right)}} \\left(a_{3} + \\operatorname{sech}{\\left(a_{2} + a_{8} s \\right)}\\right) + \\left(a_{5} + s\\right)^{a_{0}} + \\cos{\\left(4^{a_{6} - s} \\right)} + \\cos{\\left(a_{9} \\sin{\\left(s \\right)} \\right)}$", "uses": [{"slide": 2, "label": "5-z", "rep_fam": 10}, {"slide": 4, "label": "3-z", "rep_fam": 10}]}, {"key": ["x", "Add(Mul(Integer(-1), Symbol('a0'), Pow(Symbol('x0'), Symbol('a1'))), Mul(Symbol('a2'), Symbol('x0')))"], "eq": "$x(s) = - a_{0} s^{a_{1}} + a_{2} s$", "uses": [{"slide": 3, "label": "1-x", "rep_fam": 31}]}, {"key": ["y", "Add(Symbol('a1'), Mul(Symbol('a2'), cos(Mul(Symbol('a0'), exp(Symbol('x0'))))))"], "eq": "$y(s) = a_{1} + a_{2} \\cos{\\left(a_{0} e^{s} \\right)}$", "uses": [{"slide": 3, "label": "1-y", "rep_fam": 17}, {"slide": 4, "label": "3-y", "rep_fam": 17}]}, {"key": ["z", "Add(Mul(Symbol('a0'), exp(sin(Mul(Symbol('a1'), Symbol('x0'))))), Symbol('a2'))"], "eq": "$z(s) = a_{0} e^{\\sin{\\left(a_{1} s \\right)}} + a_{2}$", "uses": [{"slide": 3, "label": "1-z", "rep_fam": 18}]}, {"key": ["x", "Add(Symbol('a1'), Mul(Integer(-1), Symbol('a2'), Symbol('x0'), Add(Symbol('a0'), Mul(Integer(-1), Symbol('x0')))))"], "eq": "$x(s) = a_{1} + a_{2} s \\left(- a_{0} + s\\right)$", "uses": [{"slide": 4, "label": "3-x", "rep_fam": 40}]}];
    const eqStats  = {"unique": 13, "total_components": 15};

    function escapeHtml(s) {
      return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
    }

    function render(i) {
      const t = slides[i];

      // NOTE: eqx/eqy/eqz are already "$...$" strings.
      const eqBlock = `${t.eqx}<br/>${t.eqy}<br/>${t.eqz}`;

      const html = `
      <div class="meta">
        <b>Family ${t.fid}</b>
        <span class="mono"> (F_x=${t.Fx}, F_y=${t.Fy}, F_z=${t.Fz})</span>
      </div>

      <div id="eqViewer"></div>

      <div class="meta">
        <b>Track ${t.track_idx + 1}</b> (${escapeHtml(t.event_id)})
      </div>

      <div class="meta metrics">${t.metrics_line}</div>

      <a href="${escapeHtml(t.png)}" target="_blank" rel="noopener">
        <img id="trackImg" src="${escapeHtml(t.img_src)}" alt="Track ${t.track_idx} plot"/>
      </a>

      <div class="eq">${eqBlock}</div>
    `;

    
        document.getElementById("card").innerHTML = html;

        document.getElementById("counter").textContent =
        `Item ${i+1} / ${slides.length}`;
        
        renderEqViewer();

      // Re-typeset MathJax after DOM update
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise();
      }
    }

    let idx = 0;

    function goTo(newIndex) {
      // wrap around
      idx = (newIndex + slides.length) % slides.length;
      render(idx);
    }
    
    // -----------------------
    // Equation viewer (global)
    // -----------------------
    let eqIdx = 0;

    function renderEqViewer() {
      const container = document.getElementById("eqViewer");
      if (!container) return;

      const e = eqSlides[eqIdx];

      // build the list of clickable uses
      const usesHtml = e.uses.map(u =>
        `<a href="#" class="eqJump" data-slide="${u.slide}">${escapeHtml(u.label)}</a>`
      ).join(", ");

      container.innerHTML = `
        <div class="meta" style="margin-top:10px;">
          <b>${eqStats.unique}</b> unique equation templates used out of
          <b>${eqStats.total_components}</b> track-components.
        </div>

        <div style="display:flex; align-items:center; gap:10px; margin-top:10px;">
          <button id="eqPrev">←</button>
          <button id="eqNext">→</button>
          <span class="counter">Equation ${eqIdx + 1} / ${eqSlides.length}</span>
        </div>

        <div class="eq" style="margin-top:10px;">
          <div><b>Equation ${eqIdx + 1}:</b></div>
          <div style="margin-top:6px;">${e.eq}</div>
          <div class="meta" style="margin-top:10px;">
            ${usesHtml}
          </div>
        </div>
      `;

      // hook up arrow buttons with wrap
      document.getElementById("eqPrev").onclick = () => {
        eqIdx = (eqIdx - 1 + eqSlides.length) % eqSlides.length;
        renderEqViewer();
      };
      document.getElementById("eqNext").onclick = () => {
        eqIdx = (eqIdx + 1) % eqSlides.length;
        renderEqViewer();
      };

      // hook up each jump link
      for (const a of container.querySelectorAll(".eqJump")) {
        a.addEventListener("click", (ev) => {
          ev.preventDefault();
          const target = parseInt(a.dataset.slide, 10);
          goTo(target);

          // after the card re-renders, scroll the image into view
          setTimeout(() => {
            const img = document.getElementById("trackImg");
            if (img) img.scrollIntoView({ behavior: "smooth", block: "start" });
          }, 0);
        });
      }

      // typeset just-updated math
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise();
      }
    }


    document.getElementById("prevBtn").addEventListener("click", () => {
      goTo(idx - 1);
    });
    document.getElementById("nextBtn").addEventListener("click", () => {
      goTo(idx + 1);
    });

    window.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft")  { goTo(idx - 1); }
      if (e.key === "ArrowRight") { goTo(idx + 1); }
    });

    render(idx);

  </script>
</body>
</html>
