<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js@2.10.0/dist/plotly.min.js"></script>
    
    <title>Interactive Inverted Pendulum Solver</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <style>
        
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            color: #333;
        }
        
        .toggle-button {
                    display: inline-block;
                    padding: 0.5em 1em;
                    background-color: #007BFF;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 1em;
                    
        }
        .toggle-button:hover {
            background-color: #0056b3;
        }

        h1 {
            text-align: center;
            color: #444;
            
        }
        
        h3 {
            text-align: center;
            color: #444;
            font-weight: 700
        }
        
        h5 {
            text-align: center;
            color: #444;
            text-decoration: underline;
        }

        .control-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .control-container label {
            width: 60px; /* Set a fixed width for labels to ensure alignment */
            text-align: right;
            margin-right: 10px;
        }

        .control-container input[type="number"] {
            width: 60px; /* Set a fixed width for number inputs */
            margin-right: -25px;
        }

        .control-label {
            font-weight: bold;
            margin-right: 10px;
        }

        .arrow {
            cursor: pointer;
            font-size: 20px;
            color: #555;
            margin: 0 10px;
            user-select: none; /* Prevent text selection */
            border: 2px solid transparent; /* Prevent focus outline */
            border-radius: 5px;
            padding: 5px 10px;
            transition: background-color 0.3s, color 0.3s;
        }

        .arrow:hover {
            background-color: #007BFF;
            color: white;
        }

        .arrow:active {
            transform: scale(0.9);
        }

        .slider {
            -webkit-appearance: none;
            appearance: none;
            width: 200px;
            height: 8px;
            background: #ddd;
            border-radius: 5px;
            outline: none;
            transition: background 0.3s;
            margin: 0 10px; /* Add space around the slider */
        }

        .slider:hover {
            background: #ccc;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #007BFF;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .slider::-webkit-slider-thumb:hover {
            background: #0056b3;
        }

        .slider::-webkit-slider-thumb:active {
            transform: scale(1.2);
        }
        .plot-container {
            margin-top: 40px;
        }
        
        input[type="number"] {
            width: 60px;
            margin: 0px 0px 0px 20px;
        }
        
        label {

            margin: 0px 20px 0px 20px;
        }
        
        :root {
                --background-color: #ffffff;
                --text-color: #333333;
                --plot-bg-color: #ffffff;
                --plot-grid-color: #dddddd;
            }

            body {
                background-color: var(--background-color);
                color: var(--text-color);
            }

            .plot-container {
                background-color: var(--plot-bg-color);
            }
        
    </style>
</head>
<body>
    <h1>Interactive Inverted Pendulum Viewer</h1>
    <!--(Maybe) TODO: Add user option to select N, where N is the order of the Taylor expansion. This option should modify the entire page (derivation, equation below, JS model function) according to the order selected-->
    
    <div class="latex-equation" id="equations">
        $$\begin{align*}
        &\text{Original Horizontal about $\theta=\pi$: } \quad \ddot{\theta} + \frac{g}{l} \sin (\theta) =  \frac{ A \omega^2}{l} \cos (\theta) \cos(\omega t - \delta)  - \lambda \dot{\theta} \\
        &\text{Taylor Order-2 Horizontal about $\theta=\pi$: }\quad  \ddot{\theta} + \frac{g}{l}\left(\pi - \theta\right) =  \frac{ A \omega^2}{l}\left(-1 + \frac{(\theta-\pi)^2}{2}\right)\cos(\omega t - \delta) - \lambda \dot{\theta} \\
        &\text{Original Vertical about $\theta=\pi$: } \quad \ddot{\theta} + \frac{g}{l} \sin (\theta) = -\frac{A \omega^2}{l}  \sin (\theta) \cos(\omega t - \delta)  - \lambda \dot{\theta} \\
        &\text{Taylor Order-2 Vertical about $\theta=\pi$: } \quad \ddot{\theta} + \frac{g}{l} \left(\pi - \theta \right) = -\frac{A \omega^2}{l}  \left(\pi - \theta \right) \cos(\omega t - \delta)   - \lambda \dot{\theta}
        \end{align*}$$
    </div>
<!--    <div class="latex-equation">-->
<!--        $$\begin{align*}-->
<!--        &\text{Original Horizontal about $\theta=\pi$: } \quad \ddot{\theta} + \frac{g}{l} \sin (\theta) =  \frac{ A \omega^2}{l} \cos (\theta) \cos(\omega t - \delta)  - \lambda \dot{\theta} \\-->
<!--        &\text{Taylor Order-2 Horizontal about $\theta=\pi$: }\quad  \ddot{\theta} + \frac{g}{l}\left(\pi - \theta\right) =  \frac{ A \omega^2}{l}\left(-1 + \frac{(\theta-\pi)^2}{2}\right)\cos(\omega t - \delta) - \lambda \dot{\theta} \\-->
<!--        &\text{Original Vertical about $\theta=\pi$: } \quad \ddot{\theta} + \frac{g}{l} \sin (\theta) = -\frac{A \omega^2}{l}  \sin (\theta) \cos(\omega t - \delta)  - \lambda \dot{\theta} \\-->
<!--        &\text{Taylor Order-2 Vertical about $\theta=\pi$: } \quad \ddot{\theta} + \frac{g}{l} \left(\pi - \theta \right) = -\frac{A \omega^2}{l}  \left(\pi - \theta \right) \cos(\omega t - \delta)   - \lambda \dot{\theta}-->
<!--        \end{align*}$$-->
<!--    </div>-->
    <div class = "row">
        <div class = "col" align="center">
            <label for="order-input">Order (integer from 0): </label>
            <input type="number" id="order-input" min="0" value="2">
            <!--        <button onclick="updateEquations(); updatePlot();">Update</button>-->
            <br>
        </div>
    </div>
    <br>
    <div style = "text-align: center;"><button class="toggle-button" onclick="toggleDerivation()">Show Derivation</button></div>
    <div id="derivation" style = "display: none;">
        <br>
        <h5> Horizontal </h5>
        <div style = "text-align: center">
            <?xml version="1.0" encoding="UTF-8"?>
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="351.894" height="181.816" viewBox="0 0 351.894 181.816">
            <defs>
            <g>
            <g id="glyph-0-0">
            <path d="M 0.875 -0.59375 C 0.84375 -0.4375 0.78125 -0.203125 0.78125 -0.15625 C 0.78125 0.015625 0.921875 0.109375 1.078125 0.109375 C 1.203125 0.109375 1.375 0.03125 1.453125 -0.171875 C 1.453125 -0.1875 1.578125 -0.65625 1.640625 -0.90625 L 1.859375 -1.796875 C 1.90625 -2.03125 1.96875 -2.25 2.03125 -2.46875 C 2.0625 -2.640625 2.140625 -2.9375 2.15625 -2.96875 C 2.296875 -3.28125 2.828125 -4.1875 3.78125 -4.1875 C 4.234375 -4.1875 4.3125 -3.8125 4.3125 -3.484375 C 4.3125 -3.234375 4.25 -2.953125 4.171875 -2.65625 L 3.890625 -1.5 L 3.6875 -0.75 C 3.65625 -0.546875 3.5625 -0.203125 3.5625 -0.15625 C 3.5625 0.015625 3.703125 0.109375 3.84375 0.109375 C 4.15625 0.109375 4.21875 -0.140625 4.296875 -0.453125 C 4.4375 -1.015625 4.8125 -2.46875 4.890625 -2.859375 C 4.921875 -2.984375 5.453125 -4.1875 6.546875 -4.1875 C 6.96875 -4.1875 7.078125 -3.84375 7.078125 -3.484375 C 7.078125 -2.921875 6.65625 -1.78125 6.453125 -1.25 C 6.375 -1.015625 6.328125 -0.90625 6.328125 -0.703125 C 6.328125 -0.234375 6.671875 0.109375 7.140625 0.109375 C 8.078125 0.109375 8.453125 -1.34375 8.453125 -1.421875 C 8.453125 -1.53125 8.359375 -1.53125 8.328125 -1.53125 C 8.234375 -1.53125 8.234375 -1.5 8.1875 -1.34375 C 8.03125 -0.8125 7.71875 -0.109375 7.171875 -0.109375 C 7 -0.109375 6.921875 -0.203125 6.921875 -0.4375 C 6.921875 -0.6875 7.015625 -0.921875 7.109375 -1.140625 C 7.296875 -1.671875 7.71875 -2.765625 7.71875 -3.34375 C 7.71875 -3.984375 7.3125 -4.40625 6.5625 -4.40625 C 5.828125 -4.40625 5.3125 -3.96875 4.9375 -3.4375 C 4.9375 -3.5625 4.90625 -3.90625 4.625 -4.140625 C 4.375 -4.359375 4.0625 -4.40625 3.8125 -4.40625 C 2.90625 -4.40625 2.421875 -3.765625 2.25 -3.53125 C 2.203125 -4.109375 1.78125 -4.40625 1.328125 -4.40625 C 0.875 -4.40625 0.6875 -4.015625 0.59375 -3.84375 C 0.421875 -3.484375 0.296875 -2.90625 0.296875 -2.875 C 0.296875 -2.765625 0.390625 -2.765625 0.40625 -2.765625 C 0.515625 -2.765625 0.515625 -2.78125 0.578125 -3 C 0.75 -3.703125 0.953125 -4.1875 1.3125 -4.1875 C 1.46875 -4.1875 1.609375 -4.109375 1.609375 -3.734375 C 1.609375 -3.515625 1.578125 -3.40625 1.453125 -2.890625 Z M 0.875 -0.59375 "/>
            </g>
            <g id="glyph-0-1">
            <path d="M 4.53125 -4.984375 C 4.53125 -5.640625 4.359375 -7.03125 3.34375 -7.03125 C 1.953125 -7.03125 0.421875 -4.21875 0.421875 -1.9375 C 0.421875 -1 0.703125 0.109375 1.609375 0.109375 C 3.015625 0.109375 4.53125 -2.75 4.53125 -4.984375 Z M 1.46875 -3.625 C 1.640625 -4.25 1.84375 -5.046875 2.25 -5.765625 C 2.515625 -6.25 2.875 -6.8125 3.328125 -6.8125 C 3.8125 -6.8125 3.875 -6.171875 3.875 -5.609375 C 3.875 -5.109375 3.796875 -4.609375 3.5625 -3.625 Z M 3.46875 -3.296875 C 3.359375 -2.84375 3.15625 -2 2.765625 -1.28125 C 2.421875 -0.59375 2.046875 -0.109375 1.609375 -0.109375 C 1.28125 -0.109375 1.078125 -0.40625 1.078125 -1.328125 C 1.078125 -1.75 1.140625 -2.328125 1.390625 -3.296875 Z M 3.46875 -3.296875 "/>
            </g>
            <g id="glyph-0-2">
            <path d="M 2.578125 -6.8125 C 2.578125 -6.8125 2.578125 -6.921875 2.4375 -6.921875 C 2.21875 -6.921875 1.484375 -6.84375 1.21875 -6.8125 C 1.140625 -6.8125 1.03125 -6.796875 1.03125 -6.609375 C 1.03125 -6.5 1.140625 -6.5 1.28125 -6.5 C 1.765625 -6.5 1.78125 -6.40625 1.78125 -6.328125 L 1.75 -6.125 L 0.484375 -1.140625 C 0.453125 -1.03125 0.4375 -0.96875 0.4375 -0.8125 C 0.4375 -0.234375 0.875 0.109375 1.34375 0.109375 C 1.671875 0.109375 1.921875 -0.09375 2.09375 -0.453125 C 2.265625 -0.828125 2.390625 -1.40625 2.390625 -1.421875 C 2.390625 -1.53125 2.296875 -1.53125 2.265625 -1.53125 C 2.171875 -1.53125 2.15625 -1.484375 2.140625 -1.34375 C 1.96875 -0.703125 1.78125 -0.109375 1.375 -0.109375 C 1.078125 -0.109375 1.078125 -0.421875 1.078125 -0.5625 C 1.078125 -0.8125 1.09375 -0.859375 1.140625 -1.046875 Z M 2.578125 -6.8125 "/>
            </g>
            </g>
            <clipPath id="clip-0">
            <path clip-rule="nonzero" d="M 170 23 L 267 23 L 267 181.816406 L 170 181.816406 Z M 170 23 "/>
            </clipPath>
            </defs>
            <path fill="none" stroke-width="0.3985" stroke-linecap="butt" stroke-linejoin="miter" stroke="rgb(0%, 0%, 0%)" stroke-opacity="1" stroke-dasharray="2.98883 2.98883" stroke-miterlimit="10" d="M -0.0016875 0.0016875 L -0.0016875 170.079813 " transform="matrix(1, 0, 0, -1, 175.947, 175.947)"/>
            <g clip-path="url(#clip-0)">
            <path fill="none" stroke-width="0.3985" stroke-linecap="butt" stroke-linejoin="miter" stroke="rgb(0%, 0%, 0%)" stroke-opacity="1" stroke-miterlimit="10" d="M -0.0016875 0.0016875 L 85.041281 147.294656 " transform="matrix(1, 0, 0, -1, 175.947, 175.947)"/>
            </g>
            <path fill-rule="nonzero" fill="rgb(0%, 0%, 0%)" fill-opacity="1" d="M 263.824219 28.652344 C 263.824219 27.085938 262.554688 25.816406 260.988281 25.816406 C 259.421875 25.816406 258.152344 27.085938 258.152344 28.652344 C 258.152344 30.21875 259.421875 31.488281 260.988281 31.488281 C 262.554688 31.488281 263.824219 30.21875 263.824219 28.652344 Z M 263.824219 28.652344 "/>
            <g fill="rgb(0%, 0%, 0%)" fill-opacity="1">
            <use xlink:href="#glyph-0-0" x="259.448" y="40.612"/>
            </g>
            <path fill="none" stroke-width="0.3985" stroke-linecap="butt" stroke-linejoin="miter" stroke="rgb(0%, 0%, 0%)" stroke-opacity="1" stroke-dasharray="2.98883 1.99255" stroke-miterlimit="10" d="M -170.079813 147.294656 L 170.080344 147.294656 " transform="matrix(1, 0, 0, -1, 175.947, 175.947)"/>
            <path fill="none" stroke-width="0.3985" stroke-linecap="butt" stroke-linejoin="miter" stroke="rgb(0%, 0%, 0%)" stroke-opacity="1" stroke-miterlimit="10" d="M 28.345969 49.095438 C 19.728781 54.072 9.947531 56.693094 0.45925 56.693094 " transform="matrix(1, 0, 0, -1, 175.947, 175.947)"/>
            <path fill="none" stroke-width="0.31879" stroke-linecap="round" stroke-linejoin="round" stroke="rgb(0%, 0%, 0%)" stroke-opacity="1" stroke-miterlimit="10" d="M -1.196292 1.592556 C -1.09473 0.9949 -0.00098 0.100369 0.299801 -0.00119375 C -0.00098 -0.09885 -1.09473 -0.997287 -1.196292 -1.594944 " transform="matrix(-1, 0, 0, 1, 176.40527, 119.2551)"/>
            <g fill="rgb(0%, 0%, 0%)" fill-opacity="1">
            <use xlink:href="#glyph-0-1" x="189.628" y="117.612"/>
            </g>
            <g fill="rgb(0%, 0%, 0%)" fill-opacity="1">
            <use xlink:href="#glyph-0-2" x="225.386" y="102.871"/>
            </g>
            </svg>

        </div>

        <div class="latex-equation" style = "text-align:center">
            \[
            x = x_p(t) + l \sin (\theta) = A \cos(\omega t - \delta) + l \sin (\theta),
            \]
            \[
            y = l \cos (\theta)
            \]

            The velocity components of the pendulum bob are:
            \[
            \dot{x} = -A \omega \sin(\omega t - \delta) + l \dot{\theta} \cos (\theta),
            \]
            \[
            \dot{y} = -l \dot{\theta} \sin (\theta)
            \]

            The total kinetic energy \( T \) is therefore:
            \[
            T = \frac{1}{2} m (\dot{x}^2 + \dot{y}^2)
            \]
            Expanding this expression, we get:
            \[
            T = \frac{1}{2} m \left[ \left(-A \omega \sin(\omega t - \delta) + l \dot{\theta} \cos (\theta)\right)^2 + \left(l \dot{\theta} \sin (\theta)\right)^2 \right]
            \]

            Expanding further and simplifying, we obtain:
            \[
            T = \frac{1}{2} m \left( A^2 \omega^2 \sin^2(\omega t - \delta) + l^2 \dot{\theta}^2 - 2 A l \omega \dot{\theta} \cos (\theta) \sin(\omega t - \delta) \right)
            \]

            The potential energy \( V \) is due to gravity and is given by:
            \[
            V = -m g y = -m g l \cos (\theta)
            \]
            The Lagrangian \( L \) is given by:
            \[
            L = T - V = \frac{1}{2} m \left( A^2 \omega^2 \sin^2(\omega t - \delta) + l^2 \dot{\theta}^2 - 2 A l \omega \dot{\theta} \cos (\theta) \sin(\omega t - \delta) \right) + m g l \cos (\theta)
            \]
            Using the Euler-Lagrange equation:
            \[
            \frac{d}{dt} \left( \frac{\partial L}{\partial \dot{\theta}} \right) - \frac{\partial L}{\partial \theta} = 0,
            \]
            \[
            \frac{\partial L}{\partial \dot{\theta}} = m l^2 \dot{\theta} - m A l \omega \cos (\theta) \sin(\omega t - \delta).
            \]
            \[
            \frac{d}{dt} \left( \frac{\partial L}{\partial \dot{\theta}} \right) = m l^2 \ddot{\theta} - m A l \omega \left( -\dot{\theta} \sin (\theta) \sin(\omega t - \delta) + \cos (\theta) \omega \cos(\omega t - \delta) \right)
            \]
             \[
               \frac{\partial L}{\partial \theta} = m l \left( A \omega \dot{\theta} \sin(\omega t - \delta) \sin (\theta) - g \sin (\theta) \right)
               \]
            \[
            m l^2 \ddot{\theta} - m A l \omega \left( -\dot{\theta} \sin (\theta) \sin(\omega t - \delta) + \cos (\theta) \omega \cos(\omega t - \delta) \right) - m l \left( A \omega \dot{\theta} \sin(\omega t - \delta) \sin (\theta) - g \sin (\theta) \right) = 0
            \]
            \[
            l \ddot{\theta} - A \omega \left( -\dot{\theta} \sin (\theta) \sin(\omega t - \delta) + \cos (\theta) \omega \cos(\omega t - \delta) \right) - \left( A \omega \dot{\theta} \sin(\omega t - \delta) \sin (\theta) - g \sin (\theta) \right) = 0
            \]
            \[
            l \ddot{\theta} - A \omega \left( -\dot{\theta} \sin (\theta) \sin(\omega t - \delta) + \cos (\theta) \omega \cos(\omega t - \delta) + \dot{\theta} \sin(\omega t - \delta) \sin (\theta) \right) + g \sin (\theta) = 0
            \]
            \[
            \ddot{\theta} - \frac{ A \omega}{l} \left( -\dot{\theta} \sin (\theta) \sin(\omega t - \delta) + \cos (\theta) \omega \cos(\omega t - \delta) + \dot{\theta} \sin(\omega t - \delta) \sin (\theta) \right) + \frac{g}{l} \sin (\theta) = 0
            \]
            \[
            \ddot{\theta} + \frac{g}{l} \sin (\theta) =  \frac{ A \omega}{l} \left( -\dot{\theta} \sin (\theta) \sin(\omega t - \delta) + \cos (\theta) \omega \cos(\omega t - \delta) + \dot{\theta} \sin(\omega t - \delta) \sin (\theta) \right)
            \]
            \[
            \ddot{\theta} + \frac{g}{l} \sin (\theta) =  \frac{ A \omega}{l} \left( \cos (\theta) \omega \cos(\omega t - \delta) \right)
            \]
            \begin{equation}
                \boxed{\ddot{\theta} + \frac{g}{l} \sin (\theta) =  \frac{ A \omega^2}{l} \left( \cos (\theta) \cos(\omega t - \delta) \right)} \label{eq:horizontal_original_no_damping} \tag{1}
            \end{equation}
            Expanding about \(\theta = \pi\) yields to first order \(\sin(\theta) \sim 0 + \cos(\pi) (\theta-\pi) = \pi - \theta\), \(\cos(\theta) \sim -1\), yielding
            \[
            \boxed{\ddot{\theta} + \frac{g}{l}(\pi - \theta) =  -\frac{ A \omega^2}{l}\cos(\omega t - \delta)}
            \]
            with solution
            \[\theta{\left(t \right)} = \frac{A \omega^{2} \cos{\left(\omega t - \delta \right)}}{g + l \omega^{2}} + C_{1} e^{- \frac{\sqrt{g} t}{\sqrt{l}}} + C_{2} e^{\frac{\sqrt{g} t}{\sqrt{l}}} + \pi\]
            To second order, \(\sin(\theta) \sim (\pi - \theta)\), \(\cos(\theta) \sim -1 + \dfrac{(\theta-\pi)^2}{2}\), yielding
            \begin{equation}
                \boxed{\ddot{\theta} + \frac{g}{l}\left(\pi - \theta \right) =  \frac{ A \omega^2}{l}\left(-1 + \dfrac{(\theta-\pi)^2}{2}\right)\cos(\omega t - \delta)} \label{eq:hoizontal_second_order_no_damping} \tag{2}
            \end{equation}
            Defining \(\phi \equiv \theta - \pi\), equation \ref{eq:hoizontal_second_order_no_damping} becomes
            \begin{equation}
                \boxed{\ddot{\phi} - \frac{g}{l}\phi =  \frac{ A \omega^2}{l}\left(-1 + \dfrac{\phi^2}{2}\right)\cos(\omega t - \delta)} \label{eq:hoizontal_second_order_no_damping_phi} \tag{3}
            \end{equation}
            
            Considering linear damping simply modifies equation \ref{eq:horizontal_original_no_damping} to be:
            \begin{equation}
                \boxed{\ddot{\theta} + \frac{g}{l} \sin (\theta) =  \frac{ A \omega^2}{l} \left( \cos (\theta) \cos(\omega t - \delta) \right) -\lambda \dot{\theta}}\label{eq:horizontal_original_linear_damping}\tag{4}
            \end{equation}
            and equation \ref{eq:hoizontal_second_order_no_damping_phi} to be:
            \begin{equation}
                \boxed{\ddot{\phi} - \frac{g}{l}\phi =  \frac{ A \omega^2}{l}\left(-1 + \dfrac{\phi^2}{2}\right)\cos(\omega t - \delta) -\lambda \dot{\phi}}\label{eq:hoizontal_second_order_linear_damping}\tag{5}
            \end{equation}
            
        </div>
        <h5> Vertical </h5>
        <div style = "text-align: center">
            <?xml version="1.0" encoding="UTF-8"?>
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="351.894" height="181.816" viewBox="0 0 351.894 181.816">
            <defs>
            <g>
            <g id="glyph-0-0">
            <path d="M 0.875 -0.59375 C 0.84375 -0.4375 0.78125 -0.203125 0.78125 -0.15625 C 0.78125 0.015625 0.921875 0.109375 1.078125 0.109375 C 1.203125 0.109375 1.375 0.03125 1.453125 -0.171875 C 1.453125 -0.1875 1.578125 -0.65625 1.640625 -0.90625 L 1.859375 -1.796875 C 1.90625 -2.03125 1.96875 -2.25 2.03125 -2.46875 C 2.0625 -2.640625 2.140625 -2.9375 2.15625 -2.96875 C 2.296875 -3.28125 2.828125 -4.1875 3.78125 -4.1875 C 4.234375 -4.1875 4.3125 -3.8125 4.3125 -3.484375 C 4.3125 -3.234375 4.25 -2.953125 4.171875 -2.65625 L 3.890625 -1.5 L 3.6875 -0.75 C 3.65625 -0.546875 3.5625 -0.203125 3.5625 -0.15625 C 3.5625 0.015625 3.703125 0.109375 3.84375 0.109375 C 4.15625 0.109375 4.21875 -0.140625 4.296875 -0.453125 C 4.4375 -1.015625 4.8125 -2.46875 4.890625 -2.859375 C 4.921875 -2.984375 5.453125 -4.1875 6.546875 -4.1875 C 6.96875 -4.1875 7.078125 -3.84375 7.078125 -3.484375 C 7.078125 -2.921875 6.65625 -1.78125 6.453125 -1.25 C 6.375 -1.015625 6.328125 -0.90625 6.328125 -0.703125 C 6.328125 -0.234375 6.671875 0.109375 7.140625 0.109375 C 8.078125 0.109375 8.453125 -1.34375 8.453125 -1.421875 C 8.453125 -1.53125 8.359375 -1.53125 8.328125 -1.53125 C 8.234375 -1.53125 8.234375 -1.5 8.1875 -1.34375 C 8.03125 -0.8125 7.71875 -0.109375 7.171875 -0.109375 C 7 -0.109375 6.921875 -0.203125 6.921875 -0.4375 C 6.921875 -0.6875 7.015625 -0.921875 7.109375 -1.140625 C 7.296875 -1.671875 7.71875 -2.765625 7.71875 -3.34375 C 7.71875 -3.984375 7.3125 -4.40625 6.5625 -4.40625 C 5.828125 -4.40625 5.3125 -3.96875 4.9375 -3.4375 C 4.9375 -3.5625 4.90625 -3.90625 4.625 -4.140625 C 4.375 -4.359375 4.0625 -4.40625 3.8125 -4.40625 C 2.90625 -4.40625 2.421875 -3.765625 2.25 -3.53125 C 2.203125 -4.109375 1.78125 -4.40625 1.328125 -4.40625 C 0.875 -4.40625 0.6875 -4.015625 0.59375 -3.84375 C 0.421875 -3.484375 0.296875 -2.90625 0.296875 -2.875 C 0.296875 -2.765625 0.390625 -2.765625 0.40625 -2.765625 C 0.515625 -2.765625 0.515625 -2.78125 0.578125 -3 C 0.75 -3.703125 0.953125 -4.1875 1.3125 -4.1875 C 1.46875 -4.1875 1.609375 -4.109375 1.609375 -3.734375 C 1.609375 -3.515625 1.578125 -3.40625 1.453125 -2.890625 Z M 0.875 -0.59375 "/>
            </g>
            <g id="glyph-0-1">
            <path d="M 4.53125 -4.984375 C 4.53125 -5.640625 4.359375 -7.03125 3.34375 -7.03125 C 1.953125 -7.03125 0.421875 -4.21875 0.421875 -1.9375 C 0.421875 -1 0.703125 0.109375 1.609375 0.109375 C 3.015625 0.109375 4.53125 -2.75 4.53125 -4.984375 Z M 1.46875 -3.625 C 1.640625 -4.25 1.84375 -5.046875 2.25 -5.765625 C 2.515625 -6.25 2.875 -6.8125 3.328125 -6.8125 C 3.8125 -6.8125 3.875 -6.171875 3.875 -5.609375 C 3.875 -5.109375 3.796875 -4.609375 3.5625 -3.625 Z M 3.46875 -3.296875 C 3.359375 -2.84375 3.15625 -2 2.765625 -1.28125 C 2.421875 -0.59375 2.046875 -0.109375 1.609375 -0.109375 C 1.28125 -0.109375 1.078125 -0.40625 1.078125 -1.328125 C 1.078125 -1.75 1.140625 -2.328125 1.390625 -3.296875 Z M 3.46875 -3.296875 "/>
            </g>
            <g id="glyph-0-2">
            <path d="M 2.578125 -6.8125 C 2.578125 -6.8125 2.578125 -6.921875 2.4375 -6.921875 C 2.21875 -6.921875 1.484375 -6.84375 1.21875 -6.8125 C 1.140625 -6.8125 1.03125 -6.796875 1.03125 -6.609375 C 1.03125 -6.5 1.140625 -6.5 1.28125 -6.5 C 1.765625 -6.5 1.78125 -6.40625 1.78125 -6.328125 L 1.75 -6.125 L 0.484375 -1.140625 C 0.453125 -1.03125 0.4375 -0.96875 0.4375 -0.8125 C 0.4375 -0.234375 0.875 0.109375 1.34375 0.109375 C 1.671875 0.109375 1.921875 -0.09375 2.09375 -0.453125 C 2.265625 -0.828125 2.390625 -1.40625 2.390625 -1.421875 C 2.390625 -1.53125 2.296875 -1.53125 2.265625 -1.53125 C 2.171875 -1.53125 2.15625 -1.484375 2.140625 -1.34375 C 1.96875 -0.703125 1.78125 -0.109375 1.375 -0.109375 C 1.078125 -0.109375 1.078125 -0.421875 1.078125 -0.5625 C 1.078125 -0.8125 1.09375 -0.859375 1.140625 -1.046875 Z M 2.578125 -6.8125 "/>
            </g>
            </g>
            <clipPath id="clip-0">
            <path clip-rule="nonzero" d="M 170 23 L 267 23 L 267 181.816406 L 170 181.816406 Z M 170 23 "/>
            </clipPath>
            </defs>
            <path fill="none" stroke-width="0.3985" stroke-linecap="butt" stroke-linejoin="miter" stroke="rgb(0%, 0%, 0%)" stroke-opacity="1" stroke-dasharray="2.98883 2.98883" stroke-miterlimit="10" d="M -0.0016875 0.0016875 L -0.0016875 170.079813 " transform="matrix(1, 0, 0, -1, 175.947, 175.947)"/>
            <g clip-path="url(#clip-0)">
            <path fill="none" stroke-width="0.3985" stroke-linecap="butt" stroke-linejoin="miter" stroke="rgb(0%, 0%, 0%)" stroke-opacity="1" stroke-miterlimit="10" d="M -0.0016875 0.0016875 L 85.041281 147.294656 " transform="matrix(1, 0, 0, -1, 175.947, 175.947)"/>
            </g>
            <path fill-rule="nonzero" fill="rgb(0%, 0%, 0%)" fill-opacity="1" d="M 263.824219 28.652344 C 263.824219 27.085938 262.554688 25.816406 260.988281 25.816406 C 259.421875 25.816406 258.152344 27.085938 258.152344 28.652344 C 258.152344 30.21875 259.421875 31.488281 260.988281 31.488281 C 262.554688 31.488281 263.824219 30.21875 263.824219 28.652344 Z M 263.824219 28.652344 "/>
            <g fill="rgb(0%, 0%, 0%)" fill-opacity="1">
            <use xlink:href="#glyph-0-0" x="259.448" y="40.612"/>
            </g>
            <path fill="none" stroke-width="0.3985" stroke-linecap="butt" stroke-linejoin="miter" stroke="rgb(0%, 0%, 0%)" stroke-opacity="1" stroke-dasharray="2.98883 1.99255" stroke-miterlimit="10" d="M -170.079813 147.294656 L 170.080344 147.294656 " transform="matrix(1, 0, 0, -1, 175.947, 175.947)"/>
            <path fill="none" stroke-width="0.3985" stroke-linecap="butt" stroke-linejoin="miter" stroke="rgb(0%, 0%, 0%)" stroke-opacity="1" stroke-miterlimit="10" d="M 28.345969 49.095438 C 19.728781 54.072 9.947531 56.693094 0.45925 56.693094 " transform="matrix(1, 0, 0, -1, 175.947, 175.947)"/>
            <path fill="none" stroke-width="0.31879" stroke-linecap="round" stroke-linejoin="round" stroke="rgb(0%, 0%, 0%)" stroke-opacity="1" stroke-miterlimit="10" d="M -1.196292 1.592556 C -1.09473 0.9949 -0.00098 0.100369 0.299801 -0.00119375 C -0.00098 -0.09885 -1.09473 -0.997287 -1.196292 -1.594944 " transform="matrix(-1, 0, 0, 1, 176.40527, 119.2551)"/>
            <g fill="rgb(0%, 0%, 0%)" fill-opacity="1">
            <use xlink:href="#glyph-0-1" x="189.628" y="117.612"/>
            </g>
            <g fill="rgb(0%, 0%, 0%)" fill-opacity="1">
            <use xlink:href="#glyph-0-2" x="225.386" y="102.871"/>
            </g>
            </svg>

        </div>
        <div class="latex-equation" style = "text-align:center">
            \[
            x = l \sin (\theta),
            \]
            \[
            y = y_p(t) + l \cos (\theta) = A \cos(\omega t - \delta) + l \cos (\theta)
            \]

            The velocity components of the pendulum bob are:
            \[
            \dot{x} = l \dot{\theta} \cos (\theta),
            \]
            \[
            \dot{y} = -A \omega \sin(\omega t - \delta) - l \dot{\theta} \sin (\theta)
            \]

            The total kinetic energy \( T \) is therefore:
            \[
            T = \frac{1}{2} m (\dot{x}^2 + \dot{y}^2)
            \]
            Expanding this expression, we get:
            \[
            T = \frac{1}{2} m \left[ \left(l \dot{\theta} \cos (\theta)\right)^2 + \left(-A \omega \sin(\omega t - \delta) - l \dot{\theta} \sin (\theta)\right)^2 \right]
            \]

            Expanding further and simplifying, we obtain:
            \[
            T = \frac{1}{2} m \left( A^2 \omega^2 \sin^2(\omega t - \delta) + l^2 \dot{\theta}^2 + 2 A l \omega \dot{\theta} \sin (\theta) \sin(\omega t - \delta) \right)
            \]

            The potential energy \( V \) is due to gravity and is given by:
            \[
            V = -m g y = -m g \left(A \cos (\omega t - \delta) + l \cos (\theta)\right)
            \]
            The Lagrangian \( L \) is given by:
            \[
            L = T - V = \frac{1}{2} m \left( A^2 \omega^2 \sin^2(\omega t - \delta) + l^2 \dot{\theta}^2 + 2 A l \omega \dot{\theta} \sin (\theta) \sin(\omega t - \delta) \right) + m g \left(A \cos (\omega t - \delta) + l \cos (\theta)\right)
            \]

            Using the Euler-Lagrange equation:
            \[
            \frac{d}{dt} \left( \frac{\partial L}{\partial \dot{\theta}} \right) - \frac{\partial L}{\partial \theta} = 0,
            \]
            \[
            \frac{\partial L}{\partial \dot{\theta}} = m l^2 \dot{\theta} + m A l \omega \sin (\theta) \sin(\omega t - \delta).
            \]
            \[
            \frac{d}{dt} \left( \frac{\partial L}{\partial \dot{\theta}} \right) = m l^2 \ddot{\theta} + m A l \omega \left( \dot{\theta} \cos (\theta) \sin(\omega t - \delta) + \sin (\theta) \omega \cos(\omega t - \delta) \right)
            \]
            \[
            \frac{\partial L}{\partial \theta} = m l \left( A \omega \dot{\theta} \sin(\omega t - \delta) \cos (\theta) - g \sin (\theta) \right)
            \]
            \[
            m l^2 \ddot{\theta} + m A l \omega \left( \dot{\theta} \cos (\theta) \sin(\omega t - \delta) + \sin (\theta) \omega \cos(\omega t - \delta) \right) - m l \left( A \omega \dot{\theta} \sin(\omega t - \delta) \cos (\theta) - g \sin (\theta) \right) = 0
            \]
            \[
            l \ddot{\theta} + A \omega \left( \dot{\theta} \cos (\theta) \sin(\omega t - \delta) + \sin (\theta) \omega \cos(\omega t - \delta) \right) - \left( A \omega \dot{\theta} \sin(\omega t - \delta) \cos (\theta) - g \sin (\theta) \right) = 0
            \]
            \[
            l \ddot{\theta} + A \omega \left( \dot{\theta} \cos (\theta) \sin(\omega t - \delta) + \sin (\theta) \omega \cos(\omega t - \delta) - \dot{\theta} \sin(\omega t - \delta) \cos (\theta) \right) + g \sin (\theta) = 0
            \]
            \[
            \ddot{\theta} + \frac{A \omega}{l} \left( \dot{\theta} \cos (\theta) \sin(\omega t - \delta) + \sin (\theta) \omega \cos(\omega t - \delta) - \dot{\theta} \sin(\omega t - \delta) \cos (\theta) \right) + \frac{g}{l} \sin (\theta) = 0
            \]
            \[
            \ddot{\theta} + \frac{g}{l} \sin (\theta) = -\frac{A \omega}{l} \left( \sin (\theta) \omega \cos(\omega t - \delta) \right)
            \]
            \begin{equation}
            \boxed{\ddot{\theta} + \frac{g}{l} \sin (\theta) = -\frac{A \omega^2}{l} \left( \sin (\theta) \cos(\omega t - \delta) \right)} \label{eq:vertical_original_no_damping} \tag{6}
            \end{equation}
            Expanding about \(\theta = \pi\) yields to first order \(\sin(\theta) \sim 0 + \cos(\pi) (\theta-\pi) = \pi - \theta\), \(\cos(\theta) \sim -1\), yielding:
            \[
            \boxed{\ddot{\theta} + \frac{g}{l} (\pi - \theta) = -\frac{A \omega^2}{l} \left( (\pi - \theta) \cos(\omega t - \delta) \right)}
            \]
            To second order, \(\sin(\theta) \sim (\pi - \theta)\), \(\cos(\theta) \sim -1 + \dfrac{(\theta-\pi)^2}{2}\), yielding
            \begin{equation}
            \boxed{\ddot{\theta} + \frac{g}{l} \left(\pi - \theta \right) = -\frac{A \omega^2}{l} \left( \left(\pi - \theta \right) \cos(\omega t - \delta) \right)} \label{eq:vertical_second_order_no_damping} \tag{7}
            \end{equation}
            Defining \(\phi \equiv \theta - \pi\), equation \ref{eq:vertical_second_order_no_damping} becomes
            \begin{equation}
            \boxed{\ddot{\phi} - \frac{g}{l} \phi = \frac{A \omega^2}{l} \phi \cos(\omega t - \delta)} \label{eq:vertical_second_order_no_damping_phi} \tag{8}
            \end{equation}
            
            Considering linear damping simply modifies equation \ref{eq:vertical_original_no_damping} to be:
            \begin{equation}
                \boxed{\ddot{\theta} + \frac{g}{l} \sin (\theta) = -\frac{A \omega^2}{l} \left( \sin (\theta) \cos(\omega t - \delta) \right) -\lambda \dot{\theta}}\label{eq:vertical_original_linear_damping} \tag{9}
            \end{equation}
            and equation \ref{eq:vertical_second_order_no_damping_phi} to be:
            \begin{equation}
                \boxed{\ddot{\phi} - \frac{g}{l} \phi = \frac{A \omega^2}{l} \phi \cos(\omega t - \delta) -\lambda \dot{\phi}}\label{eq:vertical_second_order_linear_damping} \tag{10}
            \end{equation}

        </div>
    </div>
    
    <br>
    <div class="container">
        <div class="row mx-3">
            <div class="col-md">
                <label for="minA">\(A_{\text{min}}\):</label>
            </div>
            <div class="col-md">
                <input type="number" id="minA" step="0.01" value="0">
            </div>
            <div class="col-md">
                <label class="control-label">\(A\):</label>
            </div>
            <div class="col-md">
                <input id="A-slider" type="range" min="0" max="10" step="0.01" value="2" class="slider">
            </div>
            <div class="col-md">
                <input type="number" id="A-input" step="0.01" value="2" style="width: 80px;">
            </div>
            <div class="col-md">
                <label for="maxA">\(A_{\text{max}}\):</label>
            </div>
            <div class="col-md">
                <input type="number" id="maxA" step="0.01" value="10">
            </div>
        </div>
        
        <div class="row mx-3">
            <div class="col-md">
                <label for="minOmega">\(\omega_{\text{min}}\):</label>
            </div>
            <div class="col-md">
                <input type="number" id="minOmega" step="0.01" value="0">
            </div>
            <div class="col-md">
                <label class="control-label">\(\omega\):</label>
            </div>
            <div class="col-md">
                <input id="omega-slider" type="range" min="0" max="10" step="0.01" value="5" class="slider">
            </div>
            <div class="col-md">
                <input type="number" id="omega-input" step="0.01" value="5" style="width: 80px;">
            </div>
            <div class="col-md">
                <label for="maxOmega">\(\omega_{\text{max}}\):</label>
            </div>
            <div class="col-md">
                <input type="number" id="maxOmega" step="0.01" value="10">
            </div>
        </div>

        <div class="row mx-3">
            <div class="col-md">
                <label for="minL">\(l_{\text{min}}\):</label>
            </div>
            <div class="col-md">
                <input type="number" id="minL" step="0.01" value="0">
            </div>
            <div class="col-md">
                <label class="control-label">\(l\):</label>
            </div>
            <div class="col-md">
                <input id="l-slider" type="range" min="0" max="10" step="0.01" value="4" class="slider">
            </div>
            <div class="col-md">
                <input type="number" id="l-input" step="0.01" value="4" style="width: 80px;">
            </div>
            <div class="col-md">
                <label for="maxL">\(l_{\text{max}}\):</label>
            </div>
            <div class="col-md">
                <input type="number" id="maxL" step="0.01" value="10">
            </div>
        </div>

        <div class="row mx-3">
            <div class="col-md">
                <label for="minTheta0">\(\theta_{0_{\text{min}}}\):</label>
            </div>
            <div class="col-md">
                <input type="number" id="minTheta0" step="0.01" value="2.8">
            </div>
            <div class="col-md">
                <label class="control-label">\(\theta_0\):</label>
            </div>
            <div class="col-md">
                <input id="theta-slider" type="range" min="2.8" max="3.4" step="0.01" value="3" class="slider">
            </div>
            <div class="col-md">
                <input type="number" id="theta-input" step="0.01" value="3" style="width: 80px;">
            </div>
            <div class="col-md">
                <label for="maxTheta0">\(\theta_{0_{\text{max}}}\):</label>
            </div>
            <div class="col-md">
                <input type="number" id="maxTheta0" step="0.01" value="3.4">
            </div>
        </div>
        <div class="row mx-3">
            <div class="col-md">
                <label for="minLambda">\(\lambda_{\text{min}}\):</label>
            </div>
            <div class="col-md">
                <input type="number" id="minLambda" step="0.01" value="0">
            </div>
            <div class="col-md">
                <label class="control-label">\(\lambda\):</label>
            </div>
            <div class="col-md">
                <input id="lambda-slider" type="range" min="0" max="3.4" step="0.01" value="2" class="slider">
            </div>
            <div class="col-md">
                <input type="number" id="lambda-input" step="0.01" value="2" style="width: 80px;">
            </div>
            <div class="col-md">
                <label for="maxLambda">\(\lambda_{\text{max}}\):</label>
            </div>
            <div class="col-md">
                <input type="number" id="maxLambda" step="0.01" value="3.4">
            </div>
        </div>
        <div class="row mx-3">
            <div class="col-md">
                <label for="mindelta">\(\delta_{\text{min}}\):</label>
            </div>
            <div class="col-md">
                <input type="number" id="mindelta" step="0.01" value="0">
            </div>
            <div class="col-md">
                <label class="control-label">\(\delta\):</label>
            </div>
            <div class="col-md">
                <input id="delta-slider" type="range" min="0" max="3.4" step="0.01" value="0" class="slider">
            </div>
            <div class="col-md">
                <input type="number" id="delta-input" step="0.01" value="0" style="width: 80px;">
            </div>
            <div class="col-md">
                <label for="maxdelta">\(\delta_{\text{max}}\):</label>
            </div>
            <div class="col-md">
                <input type="number" id="maxdelta" step="0.01" value="3.4">
            </div>
        </div>
        <div class = "col my-3" align="center">
                <label for="deltaT">\(\Delta t\):</label>
                <input type="number" id="deltaT" value="0.01" step = "0.0001" min="0.0001" style="width: 90px;">
        </div>
        <div class = "col my-3" align="center">
                <label for="maxT">\(t_{\text{final}}\):</label>
                <input type="number" id="maxT" step="0.01" value="10">
        </div>
    </div>
    
    <div class="plot-container" id="plot"></div>
    <div class="col my-3" align="center">
        <label for="yAxisRange">Y-Axis Range:</label>
        <select id="yAxisRange" style="width: 150px;">
            <option value="variable">Variable</option>
            <option value="fixed">Fixed</option>
        </select>
    </div>
    <div class="col my-3" id="fixedRangeInputs" style="display: none;" align="center">
        <label for="yMin">Min:</label>
        <input type="number" id="yMin" step="0.1" value="-3.14" style="width: 80px;">
        <label for="yMax">Max:</label>
        <input type="number" id="yMax" step="0.1" value="9.42" style="width: 80px;">
    </div>
    <div class="col my-3" align="center">
        <label>Graph Options:</label>
        <input type="checkbox" id="showOriginal" checked>
        <label for="showOriginal">Original Horizontal</label>
        <input type="checkbox" id="showTaylor" checked>
        <label for="showTaylor", id = "showTaylorLabel">Taylor Order-2 Horizontal</label>
        
        <input type="checkbox" id="showOriginalVertical" checked>
        <label for="showOriginalVertical">Original Vertical</label>
        <input type="checkbox" id="showTaylorVertical" checked>
        <label for="showTaylorVertical", id = "showTaylorVerticalLabel">Taylor Order-2 Vertical</label>
    </div>
    <div class="col my-3" align="center">
        <label for="themeToggle">Dark Mode:</label>
        <input type="checkbox" id="themeToggle">
    </div>

    <script>
        const sliderA = document.getElementById("A-slider");
        const minInputA = document.getElementById("minA");
        const maxInputA = document.getElementById("maxA");

        minInputA.addEventListener("input", () => {
            sliderA.min = minInputA.value;
            if (parseFloat(sliderA.value) < parseFloat(sliderA.min)) {
                sliderA.value = sliderA.min;
                document.getElementById("A-value").value = sliderA.value;
            }
        });

        maxInputA.addEventListener("input", () => {
            sliderA.max = maxInputA.value;
            if (parseFloat(sliderA.value) > parseFloat(sliderA.max)) {
                sliderA.value = sliderA.max;
                document.getElementById("A-input").value = sliderA.value;
            }
        });

        sliderA.addEventListener("input", () => {
            document.getElementById("A-input").value = sliderA.value;
        });
        
        const sliderOmega = document.getElementById("omega-slider");
        const minInputOmega = document.getElementById("minOmega");
        const maxInputOmega = document.getElementById("maxOmega");

        minInputOmega.addEventListener("input", () => {
            sliderOmega.min = minInputOmega.value;
            if (parseFloat(sliderOmega.value) < parseFloat(sliderOmega.min)) {
                sliderOmega.value = sliderOmega.min;
                document.getElementById("omega-input").textContent = sliderOmega.value;
            }
        });

        maxInputOmega.addEventListener("input", () => {
            sliderOmega.max = maxInputOmega.value;
            if (parseFloat(sliderOmega.value) > parseFloat(sliderOmega.max)) {
                sliderOmega.value = sliderOmega.max;
                document.getElementById("omega-input").textContent = sliderOmega.value;
            }
        });

        sliderOmega.addEventListener("input", () => {
            document.getElementById("omega-input").textContent = sliderOmega.value;
        });
        
        const sliderL = document.getElementById("l-slider");
        const minInputL = document.getElementById("minL");
        const maxInputL = document.getElementById("maxL");

        minInputL.addEventListener("input", () => {
            sliderL.min = minInputL.value;
            if (parseFloat(sliderL.value) < parseFloat(sliderL.min)) {
                sliderL.value = sliderL.min;
                document.getElementById("l-input").textContent = sliderL.value;
            }
        });

        maxInputL.addEventListener("input", () => {
            sliderL.max = maxInputL.value;
            if (parseFloat(sliderL.value) > parseFloat(sliderL.max)) {
                sliderL.value = sliderL.max;
                document.getElementById("l-input").textContent = sliderL.value;
            }
        });

        sliderL.addEventListener("input", () => {
            document.getElementById("l-input").textContent = sliderL.value;
        });
        
        const sliderTheta = document.getElementById("theta-slider");
        const minInputTheta = document.getElementById("minTheta0");
        const maxInputTheta = document.getElementById("maxTheta0");

        minInputTheta.addEventListener("input", () => {
            sliderTheta.min = minInputTheta.value;
            if (parseFloat(sliderTheta.value) < parseFloat(sliderTheta.min)) {
                sliderTheta.value = sliderTheta.min;
                document.getElementById("theta-input").textContent = sliderTheta.value;
            }
        });

        maxInputTheta.addEventListener("input", () => {
            sliderTheta.max = maxInputTheta.value;
            if (parseFloat(sliderTheta.value) > parseFloat(sliderTheta.max)) {
                sliderTheta.value = sliderTheta.max;
                document.getElementById("theta-input").textContent = sliderTheta.value;
            }
        });

        sliderTheta.addEventListener("input", () => {
            document.getElementById("theta-input").textContent = sliderTheta.value;
        });
        
        const sliderLambda = document.getElementById("lambda-slider");
        const minInputLambda = document.getElementById("minLambda");
        const maxInputLambda = document.getElementById("maxLambda");

        minInputLambda.addEventListener("input", () => {
            sliderLambda.min = minInputLambda.value;
            if (parseFloat(sliderLambda.value) < parseFloat(sliderLambda.min)) {
                sliderLambda.value = sliderLambda.min;
                document.getElementById("lambda-input").textContent = sliderLambda.value;
            }
        });

        maxInputLambda.addEventListener("input", () => {
            sliderLambda.max = maxInputLambda.value;
            if (parseFloat(sliderLambda.value) > parseFloat(sliderLambda.max)) {
                sliderLambda.value = sliderLambda.max;
                document.getElementById("lambda-input").textContent = sliderLambda.value;
            }
        });

        sliderLambda.addEventListener("input", () => {
            document.getElementById("lambda-input").textContent = sliderLambda.value;
        });
        
        const sliderdelta = document.getElementById("delta-slider");
        const minInputdelta = document.getElementById("mindelta");
        const maxInputdelta = document.getElementById("maxdelta");

        minInputdelta.addEventListener("input", () => {
            sliderdelta.min = minInputdelta.value;
            if (parseFloat(sliderdelta.value) < parseFloat(sliderdelta.min)) {
                sliderdelta.value = sliderdelta.min;
                document.getElementById("delta-input").textContent = sliderdelta.value;
            }
        });

        maxInputdelta.addEventListener("input", () => {
            sliderdelta.max = maxInputdelta.value;
            if (parseFloat(sliderdelta.value) > parseFloat(sliderdelta.max)) {
                sliderdelta.value = sliderdelta.max;
                document.getElementById("delta-input").textContent = sliderdelta.value;
            }
        });

        sliderdelta.addEventListener("input", () => {
            document.getElementById("delta-input").textContent = sliderdelta.value;
        });
        
        // Differential equation: θ''(t) + (g/l) * sin(θ) = A * ω² * cos(ωt) * cos(θ)
        const g = 9.8; // gravitational acceleration

        // Numerical solver (Runge-Kutta 4th order method)
        function rungeKutta(h, t0, tf, y0, f) {
            let t = t0;
            let y = y0;
            const steps = Math.floor((tf - t0) / h);
            const tValues = [t];
            const yValues = [y.slice()];

            for (let i = 0; i < steps; i++) {
                const k1 = f(t, y);
                const k2 = f(t + h / 2, y.map((v, idx) => v + h / 2 * k1[idx]));
                const k3 = f(t + h / 2, y.map((v, idx) => v + h / 2 * k2[idx]));
                const k4 = f(t + h, y.map((v, idx) => v + h * k3[idx]));
                
                for (let j = 0; j < y.length; j++) {
                    y[j] += h / 6 * (k1[j] + 2 * k2[j] + 2 * k3[j] + k4[j]);
                }

                t += h;
                tValues.push(t);
                yValues.push(y.slice());
            }

            return { t: tValues, y: yValues };
        }
        
        //https://stackoverflow.com/a/3959361
        function Fact(num)
        {
            let rval=1;
            for (var i = 2; i <= num; i++)
                rval = rval * i;
            return rval;
        }
        
        function computeTaylorExpansionValue(order, theta, isSin)
        {
            let expansion = 0
            
            if (isSin)
            {
                for (let i = 1; i <= order; i += 2)
                {
                    let isPositive = (Math.floor((i + 1) / 2) % 2 == 0);
                    //let temp = String.raw`${isPositive ? '+' : '-'}\frac{(\theta - \pi)^${i}}{${i}!}`;
                    let temp = Math.pow((theta - Math.PI), i) / Fact(i);
                    expansion += (isPositive ? temp : -temp);
                }
            }
            else
            {
                for (let i = 0; i <= order; i += 2)
                {
                    let isPositive = (Math.ceil((i + 1) / 2) % 2 == 0);
                    //let temp = String.raw`${isPositive ? '+' : '-'}\frac{(\theta - \pi)^${i}}{${i}!}`
                    let temp = Math.pow((theta - Math.PI), i) / Fact(i);
                    expansion += (isPositive ? temp : -temp);
                }
            }
            return expansion;
        }

        // System of ODEs: [θ, θ']
        function pendulumODE(t, y, A, omega, l, lambda, delta) {
            const theta = y[0];
            const thetaDot = y[1];
            const thetaDDot = -(g / l) * Math.sin(theta) + (A * omega**2 / l) * Math.cos(omega * t - delta) * Math.cos(theta) - lambda * thetaDot;
            return [thetaDot, thetaDDot];
        }
        
        function pendulumODETaylor(t, y, A, omega, l, lambda, delta) {
            const theta = y[0];
            const thetaDot = y[1];
            
            // Taylor approximation
            let order = parseInt(document.getElementById('order-input').value);
            let cos_term = computeTaylorExpansionValue(order, theta, false);
            order = parseInt(document.getElementById('order-input').value);
            let sin_term = computeTaylorExpansionValue(order, theta, true);
            
            const thetaDDot = -(g / l) * (sin_term)
                              + (A * omega**2 / l) * cos_term * Math.cos(omega * t - delta) - lambda * thetaDot;

            return [thetaDot, thetaDDot];
        }
        
        function pendulumODE_vertical(t, y, A, omega, l, lambda, delta) {
            const theta = y[0];
            const thetaDot = y[1];
            const thetaDDot = -(g / l) * Math.sin(theta) - (A * omega**2 / l) * Math.cos(omega * t - delta) * Math.sin(theta) - lambda * thetaDot;
            return [thetaDot, thetaDDot];
        }
        
        function pendulumODETaylor_vertical(t, y, A, omega, l, lambda, delta) {
            const theta = y[0];
            const thetaDot = y[1];

            // Taylor approximation
            let order = parseInt(document.getElementById('order-input').value);
            let sin_term = computeTaylorExpansionValue(order, theta, true);
            
            const thetaDDot = -(g / l) * (sin_term)
                              - (A * omega**2 / l) * (sin_term) * Math.cos(omega * t - delta) - lambda * thetaDot;

            return [thetaDot, thetaDDot];
        }

        // Plotting function
        function plotResults(t, y, TaylorY, y_vert, TaylorY_vert) {
            const yAxisRangeOption = document.getElementById("yAxisRange").value;
            const yMin = parseFloat(document.getElementById("yMin").value);
            const yMax = parseFloat(document.getElementById("yMax").value);

            const showOriginal = document.getElementById("showOriginal").checked;
            const showTaylor = document.getElementById("showTaylor").checked;
            const showOriginalVertical = document.getElementById("showOriginalVertical").checked;
            const showTaylorVertical = document.getElementById("showTaylorVertical").checked;

            let traces = [];
            
            if (showOriginal)
            {
                traces.push({
                    x: t,
                    y: y.map(yi => yi[0]),  // θ(t) as function of time for the original system
                    type: 'scatter',
                    mode: 'lines',
                    name: '$\\text{Original Horizontal}$',
                    line: { color: 'blue' }
                });
            }
            
            if (showTaylor)
            {
                const order = parseInt(document.getElementById('order-input').value);
                traces.push({
                    x: t,
                    y: TaylorY.map(yi => yi[0]),  // θ(t) as function of time for the second-order approximation
                    type: 'scatter',
                    mode: 'lines',
                    name: '$\\text{Taylor Order-2 Horizontal}$'.replace("2", order),
                    line: { color: 'green' }
                });
            }
            
            if (showOriginalVertical)
            {
                traces.push({
                    x: t,
                    y: y_vert.map(yi => yi[0]),  // θ(t) as function of time for the original system
                    type: 'scatter',
                    mode: 'lines',
                    name: '$\\text{Original Vertical}$',
                    line: { color: 'orange' }
                });
            }
            
            if (showTaylorVertical)
            {
                const order = parseInt(document.getElementById('order-input').value);
                traces.push({
                    x: t,
                    y: TaylorY_vert.map(yi => yi[0]),  // θ(t) as function of time for the second-order approximation
                    type: 'scatter',
                    mode: 'lines',
                    name: '$\\text{Taylor Order-2 Vertical}$'.replace("2", order),
                    line: { color: 'magenta' }
                });
            }

            const layout = {
                title: '$\\text{Inverted Pendulum: }\\theta(t)$',
                xaxis: { title: '$\\text{Time (s)}$' },
                yaxis: {title: '$\\theta(t)\\text{ (radians)}$', range: yAxisRangeOption === "fixed" ? [yMin, yMax] : undefined},
                plot_bgcolor: getComputedStyle(document.documentElement).getPropertyValue('--plot-bg-color'),
                paper_bgcolor: getComputedStyle(document.documentElement).getPropertyValue('--background-color'),
                font: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-color') },
                showlegend: true
            };

            // Plot both traces
            Plotly.newPlot('plot', traces, layout);
            
            window.addEventListener('resize', () => {
                Plotly.Plots.resize('plot');
            });
        }


        // Update plot based on current parameters
        function updatePlot() {
            const A = parseFloat(document.getElementById('A-slider').value);
            const omega = parseFloat(document.getElementById('omega-slider').value);
            const l = parseFloat(document.getElementById('l-slider').value);
            const theta0 = parseFloat(document.getElementById('theta-slider').value);
            const lambda = parseFloat(document.getElementById('lambda-slider').value);
            const delta = parseFloat(document.getElementById('delta-slider').value);
            
            const h_min = parseFloat(document.getElementById('deltaT').min);
            let h_temp_str = document.getElementById('deltaT').value;
            let h_temp = (!h_temp_str) ? 0.01 : parseFloat(document.getElementById('deltaT').value);
            const h = (h_temp > h_min) ? h_temp : h_min; // Time step
            const t0 = 0;  // Start time
            const tf = parseFloat(document.getElementById('maxT').value); // End time

            // Update the displayed values for sliders
            document.getElementById('A-input').textContent = A;
            document.getElementById('omega-input').textContent = omega;
            document.getElementById('l-input').textContent = l;
            document.getElementById('theta-input').textContent = theta0;
            document.getElementById('lambda-input').textContent = lambda;
            document.getElementById('delta-input').textContent = delta;
            
            document.getElementById('deltaT').value = h;
            
            // Initial conditions and solver parameters
            
            let y0 = [theta0, 0];  // Initial conditions [θ₀, θ'₀]
            // Solve the system of ODEs
            const result = rungeKutta(h, t0, tf, y0, (t, y) => pendulumODE(t, y, A, omega, l, lambda, delta));
            y0 = [theta0, 0];  // Initial conditions [θ₀, θ'₀]
            const TaylorResult = rungeKutta(h, t0, tf, y0, (t, y) => pendulumODETaylor(t, y, A, omega, l, lambda, delta));
            y0 = [theta0, 0];  // Initial conditions [θ₀, θ'₀]
            const result_vertical = rungeKutta(h, t0, tf, y0, (t, y) => pendulumODE_vertical(t, y, A, omega, l, lambda, delta));
            y0 = [theta0, 0];  // Initial conditions [θ₀, θ'₀]
            const TaylorResult_vertical = rungeKutta(h, t0, tf, y0, (t, y) => pendulumODETaylor_vertical(t, y, A, omega, l, lambda, delta));
            
            // Plot the results
            plotResults(result.t, result.y, TaylorResult.y, result_vertical.y, TaylorResult_vertical.y);
            
        }
        
        function toggleDerivation() {
            const derivation = document.getElementById('derivation');
            const button = document.querySelector('.toggle-button');
            if (derivation.style.display === 'none') {
                derivation.style.display = 'block';
                button.textContent = 'Hide Derivation';
            } else {
                derivation.style.display = 'none';
                button.textContent = 'Show Derivation';
            }
        }
        
        function syncSliderWithInput(sliderId, inputId, minInputId, maxInputId) {
            const slider = document.getElementById(sliderId);
            const input = document.getElementById(inputId);
            const minInput = document.getElementById(minInputId);
            const maxInput = document.getElementById(maxInputId);

            // Synchronize slider to input
            slider.addEventListener("input", () => {
                input.value = slider.value;
                updatePlot();
            });

            // Synchronize input to slider, with delayed validation
            input.addEventListener("input", () => {
                const rawValue = input.value;

                // Allow empty or intermediate input (e.g., "3.")
                if (rawValue === "" || rawValue.endsWith(".")) {
                    return;
                }

                // Parse the input value
                const value = parseFloat(rawValue);

                // If valid, update the slider
                if (!isNaN(value)) {
                    slider.value = value;
                    updatePlot();
                }
            });

            // Validate the input and constrain it to min/max on blur
            input.addEventListener("blur", () => {
                let value = parseFloat(input.value);
                const minValue = parseFloat(minInput.value);
                const maxValue = parseFloat(maxInput.value);

                // Constrain to min/max if the value is valid
                if (!isNaN(value)) {
                    if (value < minValue) {
                        value = minValue;
                    } else if (value > maxValue) {
                        value = maxValue;
                    }
                    input.value = value;
                    slider.value = value;
                } else {
                    // If invalid, reset to the slider's current value
                    input.value = slider.value;
                }

                updatePlot();
            });

            // Update slider bounds based on min/max inputs
            minInput.addEventListener("input", () => {
                slider.min = minInput.value;
                const minValue = parseFloat(minInput.value);
                if (parseFloat(slider.value) < minValue) {
                    slider.value = minValue;
                    input.value = minValue;
                    updatePlot();
                }
            });

            maxInput.addEventListener("input", () => {
                slider.max = maxInput.value;
                const maxValue = parseFloat(maxInput.value);
                if (parseFloat(slider.value) > maxValue) {
                    slider.value = maxValue;
                    input.value = maxValue;
                    updatePlot();
                }
            });
        }
        
        document.getElementById('themeToggle').addEventListener('change', (event) => {
            const isDarkMode = event.target.checked;

            if (isDarkMode) {
                // Apply dark mode styles
                document.documentElement.style.setProperty('--background-color', '#1e1e1e');
                document.documentElement.style.setProperty('--text-color', '#ffffff');
                document.documentElement.style.setProperty('--plot-bg-color', '#1e1e1e');
                document.documentElement.style.setProperty('--plot-grid-color', '#555555');
                const elements = document.getElementsByTagName("svg");
                for (let i = 0; i < elements.length; i++)
                {
                    //console.log(elements[i].innerHTML);
                    elements[i].innerHTML = elements[i].innerHTML.replace(/rgb\(0%, 0%, 0%\)/g, "rgb(100%, 100%, 100%)");
                }
            } else {
                // Revert to light mode styles
                document.documentElement.style.setProperty('--background-color', '#ffffff');
                document.documentElement.style.setProperty('--text-color', '#333333');
                document.documentElement.style.setProperty('--plot-bg-color', '#ffffff');
                document.documentElement.style.setProperty('--plot-grid-color', '#dddddd');
                const elements = document.getElementsByTagName("svg");
                for (let i = 0; i < elements.length; i++)
                {
                    //console.log(elements[i].innerHTML);
                    elements[i].innerHTML = elements[i].innerHTML.replace(/rgb\(100%, 100%, 100%\)/g, "rgb(0%, 0%, 0%)");
                }
            }

            updatePlot(); // Update the Plotly plot to apply the new theme
        });
        
        // Function to compute Taylor expansion for sin(theta) and cos(theta) about theta = pi
        function taylorExpansion(order, isSin) {
            let expansion = [];
            
            if (isSin)
            {
                expansion = [];
                for (let i = 1; i <= order; i += 2)
                {
                    let isPositive = (Math.floor((i + 1) / 2) % 2 == 0);
                    let temp = String.raw`${isPositive ? '+' : '-'}\frac{(\theta - \pi)^${i}}{${i}!}`;
                    temp = temp.replace(String.raw`^${i}}`, "^{" + i + "}}");
                    if (i == 1 && temp[0] === "+")
                    {
                        temp = temp.slice(1);
                    }
                    //console.log(temp[0]);
                    
                    expansion.push(temp);
                }
            }
            else
            {
                expansion = [];
                for (let i = 0; i <= order; i += 2)
                {
                    let isPositive = (Math.ceil((i + 1) / 2) % 2 == 0);
                    let temp = String.raw`${isPositive ? '+' : '-'}\frac{(\theta - \pi)^${i}}{${i}!}`
                    temp = temp.replace(String.raw`^${i}}`, "^{" + i + "}}");
                    if (i == 0 && temp[0] === "+")
                    {
                        temp = temp.slice(1);
                    }
                    expansion.push(temp);
                }
            }
            
            return expansion.join(' ');
        }

        function updateEquations() {
            const order = parseInt(document.getElementById('order-input').value);
            const equationsDiv = document.getElementById('equations');

            // Compute the Taylor expansions for sin(theta) and cos(theta)
            const sinExpansion = taylorExpansion(order, true);
            const cosExpansion = taylorExpansion(order, false);

            //console.log(cosExpansion);

            const newEquations = `
            $$\\begin{align*}
            &\\text{Original Horizontal about $\\theta=\\pi$: } \\quad \\ddot{\\theta} + \\frac{g}{l} \\sin (\\theta) =  \\frac{ A \\omega^2}{l} \\cos (\\theta) \\cos(\\omega t - \\delta)  - \\lambda \\dot{\\theta} \\\\
            &\\text{Taylor Order-${order} Horizontal about $\\theta=\\pi$: }\\quad  \\ddot{\\theta} + \\frac{g}{l}\\left(${sinExpansion}\\right) =  \\frac{ A \\omega^2}{l}\\left(${cosExpansion}\\right)\\cos(\\omega t - \\delta) - \\lambda \\dot{\\theta} \\\\
            &\\text{Original Vertical about $\\theta=\\pi$: } \\quad \\ddot{\\theta} + \\frac{g}{l} \\sin (\\theta) = -\\frac{A \\omega^2}{l}  \\sin (\\theta) \\cos(\\omega t - \\delta)  - \\lambda \\dot{\\theta} \\\\
            &\\text{Taylor Order-${order} Vertical about $\\theta=\\pi$: } \\quad \\ddot{\\theta} + \\frac{g}{l} \\left(${sinExpansion}\\right) = -\\frac{A \\omega^2}{l}  \\left(${sinExpansion}\\right) \\cos(\\omega t - \\delta)   - \\lambda \\dot{\\theta}
            \\end{align*}$$`;

            equationsDiv.innerHTML = `
                ${newEquations}
            `;
            // Re-render MathJax content
            MathJax.Hub.Queue(["Typeset", MathJax.Hub,"equations"]);
            
            let horizontalLabel = document.getElementById("showTaylorLabel");
            horizontalLabel.innerText = "Taylor Order-" + order;
            let verticalLabel = document.getElementById("showTaylorVerticalLabel");
            verticalLabel.innerText = "Taylor Order-" + order + " Vertical";
            
           /* MathJax.typesetPromise()
                .then(() => console.log("MathJax re-rendered successfully"))
                .catch((err) => console.error("MathJax render error:", err));*/
        }

        // Initialize synchronization for each parameter
        syncSliderWithInput("A-slider", "A-input", "minA", "maxA");
        syncSliderWithInput("omega-slider", "omega-input", "minOmega", "maxOmega");
        syncSliderWithInput("l-slider", "l-input", "minL", "maxL");
        syncSliderWithInput("theta-slider", "theta-input", "minTheta0", "maxTheta0");
        syncSliderWithInput("lambda-slider", "lambda-input", "minLambda", "maxLambda");
        syncSliderWithInput("delta-slider", "delta-input", "mindelta", "maxdelta");

        // Event listeners for sliders
        document.getElementById('A-slider').addEventListener('input', updatePlot);
        document.getElementById('omega-slider').addEventListener('input', updatePlot);
        document.getElementById('l-slider').addEventListener('input', updatePlot);
        document.getElementById('theta-slider').addEventListener('input', updatePlot);
        document.getElementById('lambda-slider').addEventListener('input', updatePlot);
        document.getElementById('delta-slider').addEventListener('input', updatePlot);
        document.getElementById('maxT').addEventListener('input', updatePlot);
        document.getElementById('deltaT').addEventListener('input', updatePlot);
        // Show or hide the custom range inputs based on the dropdown selection
        document.getElementById('yAxisRange').addEventListener('change', () => {
            const yAxisRangeOption = document.getElementById('yAxisRange').value;
            const fixedRangeInputs = document.getElementById('fixedRangeInputs');
            fixedRangeInputs.style.display = yAxisRangeOption === "fixed" ? "block" : "none";
            updatePlot();
        });

        // Event listeners for custom range inputs
        document.getElementById('yMin').addEventListener('input', updatePlot);
        document.getElementById('yMax').addEventListener('input', updatePlot);
        // Event listeners for checkboxes
        document.getElementById('showOriginal').addEventListener('change', updatePlot);
        document.getElementById('showTaylor').addEventListener('change', updatePlot);
        document.getElementById('showOriginalVertical').addEventListener('change', updatePlot);
        document.getElementById('showTaylorVertical').addEventListener('change', updatePlot);

        

        // Function to clean up the value dynamically
        function validateAndFormatInput() {
            let orderInput = document.getElementById('order-input');
            let value = orderInput.value;

            // Parse the value as a number and check its validity
            value = parseInt(value, 10); // Convert to an integer

            // Ensure the value is a non-negative integer
            if (isNaN(value) || value < 0) {
                value = 0; // Default to 0 if invalid
            }

            // Update the input value without leading zeros
            orderInput.value = value;
            // Call your update functions dynamically
            updateEquations();
            updatePlot();
        }

        let orderInput = document.getElementById('order-input');
        // Add event listeners for input validation
        orderInput.addEventListener('input', validateAndFormatInput);
        orderInput.addEventListener('blur', validateAndFormatInput); // Also validate on losing focus

        
        // Initial plot
        updatePlot();
    </script>
</body>
</html>
